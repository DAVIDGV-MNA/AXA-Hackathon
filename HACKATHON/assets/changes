// List available deployments from the hub (helps find the right embedding ID)
app.get('/securegpt/deployments', async (req, res) => {
  try {
    const accessToken = await getAccessToken();
    // Build the base deployments URL from your known host
    const deploymentsUrl = new URL('https://api-int.se.axa-go.applications.services.axa-tech.intraxa/ago-m365-securegpt-hub-v1-vrs/providers/openai/deployments');
    deploymentsUrl.searchParams.set('api-version', '2024-10-21');

    const r = await fetch(deploymentsUrl.toString(), {
      headers: { 'Authorization': `Bearer ${accessToken}` }
    });
    const text = await r.text();
    res.status(r.status).type('application/json').send(text);
  } catch (e) {
    console.error('[/securegpt/deployments] ERROR:', e);
    res.status(500).json({ error: String(e?.message || e) });
  }
});
