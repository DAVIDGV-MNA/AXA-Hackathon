    # Determine doc-level metadata once
    sample_text = (pieces[0][0] if pieces else "")[:4000]
    title = extract_title_from_text(sample_text)
    doc_type = infer_doc_type(path, sample_text)
    keywords = derive_keywords(title, path)

    chunks = []
    for text, page in pieces:
        if not text.strip():
            continue
        for ch in simple_chunks(text):
            if not ch.strip():
                continue
            chunks.append({
                "id": str(uuid4()),
                "text": ch,
                "path": str(path),
                "page": page,
                # NEW METADATA:
                "title": title,
                "doc_type": doc_type,      # policy | process | manual | other
                "keywords": keywords,
            })
    return chunks