INDEX_FILE = STORE_DIR / "index.faiss"
META_FILE  = STORE_DIR / "meta.pkl"
META_JSONL = STORE_DIR / "metadata.jsonl"
DIM_FILE   = STORE_DIR / "dim.txt"

def _write_dim(dim: int):
    DIM_FILE.write_text(str(dim), encoding="utf-8")

def _read_dim() -> int | None:
    try:
        return int(DIM_FILE.read_text().strip())
    except:
        return None

def save_metadata_jsonl(meta: List[Dict[str, Any]]):
    with META_JSONL.open("w", encoding="utf-8") as f:
        for m in meta:
            # Keep doc-level fields per chunk for now (simple)
            f.write(json.dumps({
                "id": m["id"],
                "path": m["path"],
                "page": m.get("page", 1),
                "title": m.get("title"),
                "doc_type": m.get("doc_type"),
                "keywords": m.get("keywords", []),
            }, ensure_ascii=False) + "\n")